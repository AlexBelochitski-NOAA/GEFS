#!/bin/ksh
#
# set up base variables
# execute with dot
#
echo
echo `date` $0 $* setbase begin
echo

echo
echo `date` $0 set environment and experiment id
echo

echo envir=$envir

echo expid=${expid}

id=`echo $expid|cut -c3-4`
echo id=$id

# For virtical structure
if [[ -d $SOURCEDIR/sorc/global-workflow.fd ]] ; then
    export HOMEDIR=$SOURCEDIR
fi

if [ -d /scratch2/NCEPDEV ]; then 
    echo "Using settings for Hera"
    export machine='HERA'
    
    export HOMEDIR=${HOMEDIR:-/scratch2/NCEPDEV/ensemble/noscrub/common/git/fv3gfs/gefs_wave_fb95cd3c_20191105_newfv3upp}
    export HOMERFC=/scratch2/NCEPDEV/ensemble/save/Walter.Kolczynski/ens_tracker
    export HOMEdata=/scratch2/NCEPDEV/ensemble/noscrub/common

    export COMROOThps=${HOMEdata}
    export COMROOTp1=/scratch2/NCEPDEV/rstprod/com 
    export PATH=$PATH:/scratch2/NCEPDEV/nwprod/NCEPLIBS/utils/prod_util.v1.1.0/ush

elif [[ -d /dcom && -d /hwrf ]] ; then
    echo "Using settings for WCOSS Phase II"
    export machine='WCOSS'
    export JOBPHASE=2
    export HOMEDIR=${HOMEDIR:-/ensemble/save/Walter.Kolczynski/global-workflow/fv3gefs_f0b283bd_20190517}
    export HOMEtrak=/gpfs/hps3/emc/ensemble/save/emc.enspara/RFC/ens_tracker.v1.1.8 # Outdated version    
    export HOMEdata=/ensemble/noscrub/Walter.Kolczynski/gefs_input/gfs_15_para
    export COMINenkf_base=$HOMEdata/enkf.gdas.
    export COMINgfs_base=$HOMEdata/gfs.
    export COMINcfs_base=/ensemble/noscrub/Walter.Kolczynski/gefs_input/cfs_2_sst/cfs.

    export CHGRESEXEC=$HOMEDIR/exec/chgres_recenter.exe

elif [[ -d /gpfs/hps && -e /etc/SuSE-release ]] ; then
    echo "Using settings for WCOSS Cray"
    export machine='WCOSS_C'
    export JOBPHASE=
    export HOMEDIR=${HOMEDIR:-/gpfs/hps3/emc/ensemble/noscrub/emc.enspara/common/git/fv3gfs/gefs_wave_fb95cd3c_20191105_newfv3upp}
    export HOMEtrak=/gpfs/hps3/emc/ensemble/noscrub/emc.enspara/common/git/ens_tracker/ens_tracker.v2.1.2
    export HOMEdata=/gpfs/dell2/emc/verification/noscrub/emc.enspara/common
    export archsyndir=/gpfs/dell2/emc/verification/noscrub/emc.enspara/common/git/ens_tracker/TCvitalData/syndat
    
elif [[ -L /usrx && "$( readlink /usrx 2> /dev/null )" =~ dell ]] ; then
    # We are on NOAA Venus or Mars
    echo "Using settings for WCOSS DELL Phase III"
    export machine='WCOSS_DELL_P3'
    export JOBPHASE=
    export HOMEDIR=${HOMEDIR:-/gpfs/dell2/emc/verification/noscrub/emc.enspara/common/git/fv3gfs/gefs_wave_fb95cd3c_20191105_newfv3upp}
    export HOMEtrak=/gpfs/dell2/emc/verification/noscrub/emc.enspara/common/git/ens_tracker/ens_tracker.v2.1.2
    export HOMEdata=/gpfs/dell2/emc/verification/noscrub/emc.enspara/common
    export archsyndir=/gpfs/dell2/emc/verification/noscrub/emc.enspara/common/git/ens_tracker/TCvitalData/syndat
fi

export basesource=$SOURCEDIR
export baseoutput=$WORKDIR

echo USER BASE DIRECTORY info:
echo SOURCE: $basesource
echo OUT: $baseoutput

echo
echo `date` $0 $* setbase end
echo
