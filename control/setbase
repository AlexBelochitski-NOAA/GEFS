#!/bin/ksh
#
# set up base variables
# execute with dot
#
echo
echo `date` $0 $* setbase begin
echo

echo
echo `date` $0 set environment and experiment id
echo

#DHOU, 01/03/2013 add this block to generate the machine name related variables
  machl=`uname -n | cut -c1`
  if [[ $machl = r ]]; then
      machl=f
  fi
  if [[ $machl = n ]]; then
      machl=l
  fi

envir=$(basename $(dirname $(pwd) ) | cut -c3-)
echo envir=$envir

expid=$(basename $(dirname $(dirname $(pwd) ) ) )
id=`echo $expid|cut -c3-4`
echo expid=$expid
echo id=$id

echo
echo USER to prescribe user ID and JOB queue infirmation
echo
PROJECT=ensemble
LOGNAME=$LOGNAME
SUBMAME=
JOBPRIO=      
JOBQUEUE=dev
JOBPHASE=
#Please make sure you have the correct account information
export account=GEN-T2O

if [[ "$LOGNAME" = "emc.enspara " || "$LOGNAME" = "emc.enspara1 " ]]; then
        SUBMAME=/XX    #members of the enspara/enspara1 group accounts need to define e.g SUBNAME=/dc
        JOBPRIO=high       #(default; it could be high/max)
fi

echo USER info: $PROJECT $LOGNAME $SUBNAME $JOBPRIO

echo JOB QUEUE info prescribed: $JOBQUEUE $JOBPHASE $JOBPRIO

echo ACCOUNT info: $account

echo
echo `date` $0 set ROOT directory tree locations
echo

if [[ $machl = t ]] || [[ $machl = g ]]; then
	PTMP=/ptmpd2
	STMP=/stmpd2
	export machine='WCOSS'
	export JOBPHASE=2
	export HOMEDIR=/ensemble/save/emc.enspara/RFC
	#export HOMEDIR1=/ensemble/save/emc.enspara/RFC/q3fy17_lambda
	SAVE=/$PROJECT/save
        NOSCRUB=/$PROJECT/noscrub
fi

if [[ $machl = s ]] || [[ $machl = l ]]; then
	PTMP=/gpfs/hps3/ptmp
	STMP=/gpfs/hps3/stmp
	export machine='WCOSS_C'
	export JOBPHASE=
	export HOMEDIR=/gpfs/hps3/emc/ensemble/save/emc.enspara/RFC
        export HOMEDIR=/gpfs/hps3/emc/ensemble/noscrub/emc.enspara/Bing.Fu/svn/fv3gfs   #temporay setting
        export HOMEDIR=/gpfs/hps3/emc/ensemble/noscrub/Xiaqiong.Zhou/svn/fv3gfs   #temporay setting
        export HOMEDIRXZ=/gpfs/hps3/emc/ensemble/noscrub/Xiaqiong.Zhou/svn/fv3gfs
	SAVE=/gpfs/hps3/emc/$PROJECT/save
	NOSCRUB=/gpfs/hps3/emc/$PROJECT/noscrub
fi

export JOBQUEUE=$JOBQUEUE$JOBPRIO$JOBPHASE
echo JOB QUEUE info: $JOBQUEUE 

echo ROOT DIRECTORY info:
echo $machine  jobqueue=$JOBQUEUE
echo ptmp: $PTMP
echo stmp: $STMP
echo save: $SAVE
echo noscrub: $NOSCRUB
echo homedir: $HOMEDIR

echo
echo `date` $0 setuser base directory tree locations
echo

export basesource=$SAVE/$LOGNAME$SUBNAME/GEFS/$expid
export basebin=$basesource/nw$envir/control

export baseoutput=$PTMP/$LOGNAME$SUBNAMEE/o/$expid
export basetmp=$PTMP/$LOGNAME$SUBNAME/o/$expid
export baseptmp=$PTMP/$LOGNAME$SUBNAME/o/$expid
export basestmp=$STMP/$LOGNAME$SUBNAME/o/$expid
export baselog=$PTMP/$LOGNAME/o/$expid

export basedgfs=$NOSCRUB/$LOGNAME$SUBNAME/o

echo USER BASE DIRECTORY info:
echo SOURCE: $basesource
echo BIN: $basebin
echo OUT: $baseoutput
echo LOG: $baselog

echo
echo `date` $0 $* setbase end
echo
